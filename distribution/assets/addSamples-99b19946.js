import{_ as E}from"./AppTextField-a1a28005.js";import{r as v,o as C,f as P,e as s,d as r,v as b,m as c,b as o,t as k,a6 as V,c as N,bf as j,ch as $,an as H,aF as F,F as U}from"./index-7294bbd4.js";import{e as M,V as O,u as G,a as K,n as h}from"./TableViews-57cd31e9.js";import{f as D}from"./VTable-65129b7d.js";import{V as z}from"./VChip-591b382a.js";import{V as Q}from"./VCardText-f3dad09d.js";import{V as S}from"./VCol-7f95da18.js";import{V as T}from"./VRow-4111d537.js";import"./VSelectionControl-77cf70c7.js";import"./VInput-ee82279d.js";import"./VImg-58e9b6f4.js";import"./VTextField-b6d8b014.js";import"./forwardRefs-6ea3df5c.js";import"./_commonjsHelpers-de833af9.js";import"./api-dde3c648.js";import"./VCard-b5c127a0.js";import"./VAvatar-0272051e.js";import"./VDialog-fa37f33b.js";import"./VOverlay-674fe774.js";import"./VList-76b48cdc.js";import"./VDivider-34c6095b.js";import"./VMenu-81ec18fe.js";const J={class:"d-flex flex-column ms-3"},W={class:"d-block font-weight-medium text-high-emphasis text-truncate"},X={class:"d-flex flex-column ms-3"},Y={class:"d-block font-weight-medium text-high-emphasis text-truncate"},Z={class:"d-flex flex-column ms-3"},L={class:"d-block font-weight-medium text-high-emphasis text-truncate"},ee=r("div",{class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},null,-1),te={__name:"TableBasic",props:{items:Array,cleanTrigger:Boolean,colspan:Number,subHeaders:Array,buttonConfigs:Object,loading:Boolean},setup(n){const i=n,_=[{title:"ID MUESTRAS",key:"sampling_id"},{title:"Ped. Calidad",key:"quality_order_number"},{title:"METODO",key:"quality_test_group_id"},{title:"ACCIÃ“N",key:"actions"}],w=v(!0),y=e=>{if(e===8||e===6)return w.value=!0,{color:"success",text:"Activa"};if(e===7)return{color:"warning",text:"Inactiva"}},m=e=>{const f=i.items.findIndex(t=>t.sampling_id===e.sampling_id);f!==-1&&i.items.splice(f,1)};return(e,f)=>(C(),P(c(O),{loading:n.loading,colspan:n.colspan,headers:_,items:i.items,class:"rounded-lg elevation-1"},{"item.sampling_id":s(({item:t})=>[r("div",J,[r("span",W,b(t.sampling_id),1)])]),"item.program_start_equipment_process":s(({item:t})=>[r("div",X,[r("span",Y,b(("formatIsoDateTimeToReadable"in e?e.formatIsoDateTimeToReadable:c(D))(t.program_start_equipment_process)),1)])]),"item.program_end_equipment_process":s(({item:t})=>[r("div",Z,[r("span",L,b(("formatIsoDateTimeToReadable"in e?e.formatIsoDateTimeToReadable:c(D))(t.program_end_equipment_process)),1)])]),"item.actions":s(({item:t})=>[o(M,{"show-edit":n.buttonConfigs.showEdit,"show-delete":n.buttonConfigs.showDelete,"show-check":n.buttonConfigs.showCheck,"show-go-to-button":n.buttonConfigs.showGoto,onDelete:x=>m(t)},null,8,["show-edit","show-delete","show-check","show-go-to-button","onDelete"])]),"item.entity_lifecycle_id":s(({item:t})=>[o(z,{color:y(t.entity_lifecycle_id).color,size:"small"},{default:s(()=>[k(b(y(t.entity_lifecycle_id).text),1)]),_:2},1032,["color"])]),bottom:s(()=>[o(Q,{class:"pt-2"},{default:s(()=>[ee]),_:1})]),_:1},8,["loading","colspan","items"]))}},se={class:"d-flex justify-end mt-4 mb-6"},De={__name:"addSamples",setup(n){const i=G(),_=K(),w=V(()=>i.SubHeaders),y=V(()=>_.currentProcess),m=v(),e=v([]),f=v(10),t={showEdit:!1,showDelete:!0,showCheck:!1,showGoto:!1},x=async u=>{await i.fetchSamplesById(u);const a=(g,d)=>d?g.every(R=>R.quality_test_group_id===d.quality_test_group_id):!0,l=g=>!e.value.some(d=>d.sampling_id===g.sampling_id),p=Array.isArray(i.samples)?i.samples:[i.samples];if(p.length>0){const g=e.value.length>0?e.value[0]:void 0;if(a(p,g)){const d=p.filter(l);d.length>0?e.value.push(...d):h("addition","duplicate")}else h("addition","fail")}else h("addition","empty");q()},q=()=>{m.value=""},I=async()=>{if(e.value.length===0){h("creation","empty");return}const u={processData:{quality_order_number:e.value[0].quality_order_number,quality_test_group_id:e.value[0].quality_test_group_id},sampleProcessesData:e.value.map(a=>({sampling_id:a.sampling_id,item_id:a.item_id,item_batch_id:a.item_batch_id}))};try{await i.createNewProcess(u),e.value=[]}catch{}},B=async()=>{if(e.value.length===0){h("creation","empty");return}const u=y.value.process_code,a={aggregate:e.value.map(l=>({sampling_id:l.sampling_id,item_id:l.item_id,item_batch_id:l.item_batch_id}))};try{await i.aggregateSamplesProcess(u,a.aggregate),e.value=[]}catch{}},A=()=>{_.openBySection==="samples"?I():B(),_.openBySection=null};return(u,a)=>{const l=E;return C(),N(U,null,[o(T,{align:"center",justify:"center",dense:""},{default:s(()=>[o(S,{cols:"12",md:"12"},{default:s(()=>[o(l,{modelValue:c(m),"onUpdate:modelValue":a[0]||(a[0]=p=>j(m)?m.value=p:null),"prepend-inner-icon":"tabler-qrcode",placeholder:"MUES",onKeyup:a[1]||(a[1]=$(p=>x(c(m)),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1}),o(T,{align:"center",justify:"center",dense:""},{default:s(()=>[o(S,{cols:"12",md:"12"},{default:s(()=>[o(te,{items:c(e),colspan:c(f),"sub-headers":c(w),"button-configs":t,loading:!1},null,8,["items","colspan","sub-headers"])]),_:1}),o(S,{cols:"12",md:"12"},{default:s(()=>[r("div",se,[o(H,{type:"submit",onClick:A},{default:s(()=>[o(F,{start:"",icon:"tabler-send"}),k(" ENVIAR ")]),_:1})])]),_:1})]),_:1})],64)}}};export{De as default};
